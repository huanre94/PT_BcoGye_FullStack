<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>
      Productos
    </ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="logout()">
        <ion-icon name="log-out-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div class="products-container">
    <div class="products-grid">
      <ion-card *ngFor="let product of products" class="product-card">
        <div class="product-image-container">
          <img [src]="product.image" [alt]="product.name" />
        </div>
        
        <ion-card-header>
          <ion-card-title>{{ product.name }}</ion-card-title>
          <ion-card-subtitle class="price">${{ product.price | number:'1.2-2' }}</ion-card-subtitle>
        </ion-card-header>

        <ion-card-content>
          <div class="product-actions">
            <ion-button 
              fill="outline" 
              size="small"
              (click)="toggleWishlist(product)"
              [color]="isInWishlist(product.id) ? 'danger' : 'medium'">
              <ion-icon 
                [name]="isInWishlist(product.id) ? 'heart' : 'heart-outline'"
                slot="icon-only">
              </ion-icon>
            </ion-button>
            
            <ion-button 
              expand="block" 
              size="small"
              (click)="addToCart(product)"
              class="add-to-cart-btn">
              <ion-icon name="cart-outline" slot="start"></ion-icon>
              Agregar al carrito
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>

  <ion-infinite-scroll 
    threshold="100px" 
    [disabled]="!hasMoreData"
    (ionInfinite)="loadProducts($event)">
    <ion-infinite-scroll-content
      loadingSpinner="bubbles"
      loadingText="Cargando mÃ¡s productos...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>

  <!-- Loading skeleton for initial load -->
  <div *ngIf="isLoading && products.length === 0" class="loading-skeleton">
    <div class="products-grid">
      <ion-card *ngFor="let item of [1,2,3,4,5,6]" class="product-card skeleton">
        <div class="product-image-container">
          <ion-skeleton-text animated style="width: 100%; height: 200px;"></ion-skeleton-text>
        </div>
        <ion-card-header>
          <ion-skeleton-text animated style="width: 80%;"></ion-skeleton-text>
          <ion-skeleton-text animated style="width: 60%;"></ion-skeleton-text>
        </ion-card-header>
        <ion-card-content>
          <ion-skeleton-text animated style="width: 100%; height: 40px;"></ion-skeleton-text>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>
